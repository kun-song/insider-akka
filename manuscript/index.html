<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7.1">
<meta name="author" content="Konrad 'ktoso' Malawski">
<title>Insider Akka</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Insider Akka</h1>
<div class="details">
<span id="author" class="author">Konrad 'ktoso' Malawski</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_foreword">Foreword</a>
<ul class="sectlevel2">
<li><a href="#_about_akka">About Akka</a></li>
<li><a href="#_acknowlagements">Acknowlagements</a></li>
<li><a href="#_about_the_author">About the author</a></li>
</ul>
</li>
<li><a href="#_intro">1. Intro</a>
<ul class="sectlevel2">
<li><a href="#_versions_referred_to_in_this_book">1.1. Versions referred to in this book</a></li>
<li><a href="#_resource_recommendations_to_learn_akka">1.2. Resource recommendations to <em>learn</em> Akka</a></li>
</ul>
</li>
<li><a href="#_guiding_principles">2. Guiding Principles</a>
<ul class="sectlevel2">
<li><a href="#_islands_of_sanity_in_a_sea_of_parallelism">2.1. Islands of sanity, in a sea of parallelism</a></li>
<li><a href="#_immutability_everywhere">2.2. Immutability everywhere</a></li>
<li><a href="#_high_performance_but_not_at_all_costs">2.3. High-performance, but not at all costs</a></li>
</ul>
</li>
<li><a href="#_actor_internals">3. Actor internals</a>
<ul class="sectlevel2">
<li><a href="#_why_the_historical_type_unsafety">3.1. Why the historical type-unsafety?</a></li>
<li><a href="#_protocol_design">3.2. Protocol Design</a></li>
<li><a href="#_the_dungeonwhat_makes_the_actors_run">3.3. The dungeon&#8201;&#8212;&#8201;what makes the Actors run</a></li>
<li><a href="#_differences_between_system_actors_and_normal_ones">3.4. Differences between System Actors and normal ones</a></li>
<li><a href="#_do_the_guardian_actors_have_a_parent">3.5. Do the Guardian actors have a parent?</a></li>
<li><a href="#_restarting_actors">3.6. Restarting Actors</a></li>
<li><a href="#_sending_local_messages">3.7. Sending (Local) Messages</a></li>
<li><a href="#_sending_messages_to_distant_nodes_remoting">3.8. Sending Messages to distant nodes (Remoting)</a></li>
<li><a href="#_processing_messages">3.9. Processing messages</a></li>
<li><a href="#_death_watch_watch_ing_actors_for_lifecycle_events">3.10. Death Watch: <code>watch</code>-ing Actors for lifecycle events</a></li>
</ul>
</li>
<li><a href="#_remoting_internals">4. Remoting internals</a>
<ul class="sectlevel2">
<li><a href="#_streaming_remoting_pipeline">4.1. Streaming remoting pipeline</a></li>
<li><a href="#_message_metadata_compression_table_protocol">4.2. Message Metadata Compression Table Protocol</a></li>
<li><a href="#_swappable_transports_aeron_udp_akka_io_tcptls">4.3. Swappable transports Aeron (UDP) / Akka IO (TCP+TLS)</a></li>
</ul>
</li>
<li><a href="#_apis_that_guide_and_protect">5. APIs that guide and protect</a>
<ul class="sectlevel2">
<li><a href="#_streams_graphstagedesign_analysis">5.1. Streams' GraphStage&#8201;&#8212;&#8201;design analysis</a></li>
<li><a href="#_typed_actorsdesign_analysis">5.2. Typed Actors&#8201;&#8212;&#8201;design analysis</a></li>
</ul>
</li>
<li><a href="#_stream_api_levels_of_power_and_abstraction">6. Stream API levels of power and abstraction</a>
<ul class="sectlevel2">
<li><a href="#_operators_the_safe_heaven">6.1. Operators, the "safe heaven"</a></li>
<li><a href="#_graphs_for_arbitrary_shapes">6.2. Graphs, for arbitrary shapes</a></li>
<li><a href="#_stages_for_arbitrary_logic_protected_from_concurrency_issues">6.3. Stages, for arbitrary logic protected from concurrency issues</a></li>
<li><a href="#_reactive_streams_spi_all_concurrency_issues_and_hell_set_lose">6.4. Reactive Streams SPI, all concurrency issues and hell set lose</a></li>
</ul>
</li>
<li><a href="#_the_depths_of_stream_materialization">7. The depths of Stream Materialization</a>
<ul class="sectlevel2">
<li><a href="#_materialization_or_traversing_the_blueprints">7.1. Materialization, or "Traversing the blueprints"</a></li>
<li><a href="#_examining_the_engine_running_it_all_actorinterpreter">7.2. Examining the Engine running it all: ActorInterpreter</a></li>
</ul>
</li>
<li><a href="#_scheduling_timers">8. Scheduling (Timers)</a>
<ul class="sectlevel2">
<li><a href="#_no_wall_clock_time_in_a_cluster">8.1. No wall-clock time in a Cluster</a></li>
<li><a href="#_the_lightarrayrevolverscheduler">8.2. The LightArrayRevolverScheduler</a></li>
<li><a href="#_the_un_deniable_existence_of_wall_clock_time">8.3. The un-deniable existence of wall-clock time</a></li>
</ul>
</li>
<li><a href="#_cluster_failure_detection">9. Cluster Failure-detection</a>
<ul class="sectlevel2">
<li><a href="#_transport_failures_and_cluster_level_semantics">9.1. Transport failures and Cluster-level semantics</a></li>
<li><a href="#_fail_over_scenarios_exposed">9.2. Fail-over scenarios exposed</a></li>
</ul>
</li>
<li><a href="#_networks_and_types">10. Networks and Types</a>
<ul class="sectlevel2">
<li><a href="#_a_receptionist_for_thy_actors">10.1. A Receptionist for thy Actors</a></li>
</ul>
</li>
<li><a href="#_type_safe_http">11. Type-safe HTTP</a>
<ul class="sectlevel2">
<li><a href="#_akka_https_domain_model">11.1. Akka HTTP&#8217;s Domain Model</a></li>
<li><a href="#_spraying_the_routesa_note_on_type_safe_routing_dsls">11.2. Spraying the Routes&#8201;&#8212;&#8201;a note on type-safe routing DSLs</a></li>
</ul>
</li>
<li><a href="#_the_people_crazy_enough_to_think_they_can_change_the_world">12. The people crazy enough to think they can change the world&#8230;&#8203;</a>
<ul class="sectlevel2">
<li><a href="#_asyncawait_within_receive_blocks">12.1. Async/await within receive blocks</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_foreword">Foreword</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_about_akka">About Akka</h3>
<div class="paragraph">
<p>Jonas / Roland?</p>
</div>
</div>
<div class="sect2">
<h3 id="_acknowlagements">Acknowlagements</h3>
<div class="paragraph">
<p>I would like to thank the entire Akka community, for making it what it is today, and what it will grow to become in the future.
You are an amazing, welcoming, and professional community, thank you.</p>
</div>
<div class="paragraph">
<p>I would like to thank the core Akka team for being the best team I&#8217;ve ever worked with, and can hardly imagine finding another team as skilled,
well oiled and focused on improving the project as this one. Thanks: all names</p>
</div>
</div>
<div class="sect2">
<h3 id="_about_the_author">About the author</h3>
<div class="paragraph">
<p>Konrad 'ktoso' Malawski graduated from the AGH University of Science and Technology. He has worked in small startups, as well as large companies such as eBay, and has been part of the core Akka team at Typesafe/Lightbend since 2014 (just before Akka&#8217;s 5th anniversary! <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>). He has contributed to most, if not all, modules of Akka, maintaining a strong 2nd committer ranking across its main projects during that time. He has taken care of maintaining Akka HTTP while we were waiting to staff up its team as well as been the helping hand of the teams Tech Lead. He concurrently holds the 2nd most commits in either of these projects, and has lead to founding a number of satelite projects around the Akka "core" ecosystem.</p>
</div>
<div class="paragraph">
<p>He participated in the Reactive Streams initiative, by both working on the extensive Technology Compatibility Kit as well as contributing in discussions (on- and off-line), over the last years. He also authored a short, independent, report ("mini book") called <em>Why Reactive?</em> for O&#8217;Reilly in 2015.</p>
</div>
<div class="paragraph">
<p>Outside of the Akka and Reactive ecosystem he has been part of the PolishJUG and GeeCON conference&#8217;s leadership group, which since 10 years gathers more than 1,200 developers each year in the heart of Krakow, Poland. He (co-)founded: KrakowScala, Lambda Lounge Krakow, The PaperCup London and was leading the Krakow GTUG during its initial years and while it&#8217;s later been renamed GDG (Google Developers Group).</p>
</div>
<div class="paragraph">
<p>&#8201;&#8212;&#8201;Tokyo, July 2018</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_intro">1. Intro</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I started writing this book out of a personal need to explain and share some of the internals that Akka has accumulated. While there is plenty books about Akka out there which go over the basics, as well as the reference documentation and guides, that we in the team continue to work on and improve. None of these resources are really going to take you from "Okey, I know how to use Akka", to "Now I fully understand how it works".</p>
</div>
<div class="paragraph">
<p>Such knowladge can be obtained by watching talks, reading Akka source-code and contributing to Akka itself. But still, it is difficult to extract rationale and process that led to some of the decisions in "one go". As all of core Akka development is made in the open <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> so you&#8217;d of course be able to find all this information by spending days reviewing pull requests, issues and design discussions in there, however that would be so time consuming, that rarely anyone does so.</p>
</div>
<div class="paragraph">
<p>By writing this book, I hope to share wth you knowladge that would be really hard to gather by someone who&#8217;s entire all-around-the-clock isn&#8217;t dedicated to building and improving Akka. This book is not intended to teach Akka, however if you had exposure to Akka&#8217;s APIs, or concurrent and distributed programming in the past, you may find it a refreshing (and hopefully at least a bit enlightening) read about internals of one of the most popular library for building reactive distributed systems.</p>
</div>
<div class="sect2">
<h3 id="_versions_referred_to_in_this_book">1.1. Versions referred to in this book</h3>
<div class="paragraph">
<p>Details about the <code>ActorSystem</code> are referring to the <code>2.x</code> lifecycle of Akka.
The <code>1.x</code> version of Akka was quite different, and we will not spend time on it in this book as the 2.x series is vastly superior,
and been the de facto standard for more than 5 years by now. More specifically, whenever we&#8217;ll talk about specific code, you may
assume that we are talking about the Akka <code>2.5.x</code> series.</p>
</div>
<div class="paragraph">
<p>The same versions assumption, unless stated otherwise, hold for Akka Streams. Though we may refer to previous implementations of it as well,
which will be highlighted explicitly when we do so.</p>
</div>
<div class="paragraph">
<p>For some discussion of an completely new <code>ActorSystem[T]</code> implementation for Akka Typed we will mostly refer to Roland Kuhn&#8217;s attempt to
implementing such system. However please note that this system implementation has not been merged and by the time a full "native" (rather
than emulated on top of "Akka classic" (Untyped)) implementation of a Typed actor system would be merged, we could expect a number of changes,
improvements and "hardening" be applied to it.</p>
</div>
<div class="paragraph">
<p>Whenever talking about Akka HTTP we will be talking about its <code>10.1.x</code> release cycle.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resource_recommendations_to_learn_akka">1.2. Resource recommendations to <em>learn</em> Akka</h3>
<div class="paragraph">
<p>This book is not an introduction to Akka.</p>
</div>
<div class="paragraph">
<p>Far from it; it assumes knowladge (at least on a conceptual level) of Akka and its modules (such as Actors, Cluster, Streams, HTTP etc.), as well as concurrency and distributed systems knowladge at least on a level that will allow you to track the implemenation decisions explained in this book.</p>
</div>
<div class="paragraph">
<p>As alternative books to start out with Akka, I strongly recommend the following books:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you are looking to start your journey with reactive systems and Akka, I would instead recommend to start out with Raymond Roestenburg&#8217;s <a href="https://www.manning.com/books/akka-in-action">Akka in Action</a>,</p>
</li>
<li>
<p>If you are looking to understand reactive architectures and patterns, which happen to be nicely implementable using Akka, I recommend Roland Kuhn&#8217;s (ex Akka Tech Lead) <a href="https://www.manning.com/books/reactive-design-patterns">Reactive Design Patterns</a>,</p>
</li>
<li>
<p>Last but not least, do not be shy to refer to the official <a href="https://doc.akka.io">Reference Documentation</a>. Which is available with examples in both Java and Scala (with an equal level of attention and quality).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While this book indeed is not going to teach you about using Akka, you are absolutely welcome to continue reading if you are curious about how one of the most popular reactive systems library (pretty much having coined the Reactive Manifesto and the term Reactive Systems) is implemented and want to learn about algorithms and data structures used by Akka internally, do bear in mind though that having some exposure to using Akka will be very helpful in understanding why some of the crazy things in the internals are the way they are - since they benefit the end users of the API.</p>
</div>
<div class="paragraph">
<p>Most, if not all, of the details outlined in this book should be mostly irrelevant to developers <em>using</em> Akka, however if you are an advanced user
it may help you understand how to make better use of it (i.e. avoiding APIs which are "costly", and understanding why they are).</p>
</div>
<div class="paragraph">
<p>With that being said&#8230;&#8203; welcome to <em>Insider Akka</em>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_guiding_principles">2. Guiding Principles</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_islands_of_sanity_in_a_sea_of_parallelism">2.1. Islands of sanity, in a sea of parallelism</h3>
<div class="sect3">
<h4 id="_the_single_threaded_illusion_of_actors">2.1.1. The "single-threaded illusion" of Actors</h4>

</div>
</div>
<div class="sect2">
<h3 id="_immutability_everywhere">2.2. Immutability everywhere</h3>
<div class="paragraph">
<p>One might wonder why immutability is a guiding principle in Akka which is all about Actors,
which after all are <strong>all about</strong> encapsulating mutable state (that&#8217;s the one thing they&#8217;re best at!)</p>
</div>
<div class="sect3">
<h4 id="_bytestringimmutable_bytes">2.2.1. ByteString&#8201;&#8212;&#8201;immutable bytes</h4>

</div>
<div class="sect3">
<h4 id="_immutability_sanity">2.2.2. Immutability &#8658; Sanity</h4>

</div>
</div>
<div class="sect2">
<h3 id="_high_performance_but_not_at_all_costs">2.3. High-performance, but not at all costs</h3>
<div class="paragraph">
<p>Actors are often referred to in the context of "high performance" messaging, and while this certainly can be true,
it should also be put into perspective. It may be high performance "enough" for a person coming from an usual
single-threaded and/or single-node processing paradigm, someone who&#8217;s been working on high frequency trading would
not call actors high performance, even though those systems share many similarities with Actors (processing messages
from a queue in order, having addressable entities etc).</p>
</div>
<div class="paragraph">
<p>In the context of Akka it is important to keep in mind the "not at all costs" performance motto. Akka realises that for the
vast majority of use cases its actors implementation is aboslutely "high performance enough" (esp. since Akka can also fan
out the processing across many nodes), and does not aim to serve the 10% cases where Actors and the GC of short lived objects
they cause is not a good fit.</p>
</div>
<div class="paragraph">
<p>A specific example could be discussing if Akka should or should not carry messages between actors in so-called Envelopes.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_actor_internals">3. Actor internals</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_why_the_historical_type_unsafety">3.1. Why the historical type-unsafety?</h3>

</div>
<div class="sect2">
<h3 id="_protocol_design">3.2. Protocol Design</h3>
<div class="sect3">
<h4 id="_typed_protocol_design">3.2.1. Typed Protocol Design</h4>
<div class="paragraph">
<p>While we have not yet talked much about Akka Typed (which is an type-safe API on to</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_dungeonwhat_makes_the_actors_run">3.3. The dungeon&#8201;&#8212;&#8201;what makes the Actors run</h3>
<div class="sect3">
<h4 id="_making_of_a_cyborg_starting_actors">3.3.1. Making of a Cyborg: Starting Actors</h4>
<div class="paragraph">
<p>As well versed Akka developer you likely know that top-level Actors are more "expensive" than child Actors.
Have you ever wondered why that is? In this section we&#8217;ll explore how Actors are created, and this will also explain
why and how top level actors are more difficult for the infrastructure to start than child actors.</p>
</div>
<div class="paragraph">
<p>Hint: it relates to "from the outside of system" initiated starting of them vs. from "the inside of the system/actor".</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Note</dt>
<dd>
<p>You are highly encouraged to loop the fantastic track "Making of a Cyborg" by Kenji Kawai, from the 1995 movie
'Ghost in the Shell' while reading this chapter. Here is a youtube search for it: <code><a href="https://www.youtube.com/results?search_query=kenji+kawai+making+of+a+cyborg" class="bare">https://www.youtube.com/results?search_query=kenji+kawai+making+of+a+cyborg</a></code></p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="_guardian_actors">Guardian Actors</h5>
<div class="paragraph">
<p>The Untyped <code>ActorSystem</code> has 2 main guardians, they are maintained by Akka itself.</p>
</div>
<div class="paragraph">
<p>The <code>/user</code> guardian is where we "attach" all actors started by users, e.g. by <code>system.actorOf</code>,
and the <code>/system</code> guardian is where we "attach" all actors started using the special <code>system: ExtendedActorSystem.systemActorOf</code>
actors. They don&#8217;t really differ in behavior so much; The user guardians supervision strategy can be configured by config by users,
but the system one not. During shutting down the system, the system actors are shut down LAST (CHECK THIS), after all user actors are stopped.
That&#8217;s about it.</p>
</div>
</div>
<div class="sect4">
<h5 id="_system_actorof">system.actorOf</h5>
<div class="paragraph">
<p>This is how we start (or "spawn") "top-level" actors. Note that we are not IN the <code>/user</code> guardian, we are after all "somewhere on the side"
yet we need to attach the new child to the <code>/user</code> guardian. This means we have to send a message to the user guardian asynchronously
for it to perform the spawning, yet at the same time we do not want to block while we do this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-scala" data-lang="scala">val ref = system.actorOf(act, "major")
  // sync: notice we got our ActorRef back immediately (!)
ref ! "Reporting for duty!" // we immediately send
  // async: dear `/user`, please attach child `major`
  // async: `/user`: reserved name "major"
  // async: `/user`: initializing `/user/major`
  // async: `/user`: repoint (!) `ref` to `/user/major`!</code></pre>
</div>
</div>
<div class="paragraph">
<p>The main principle here is that a) we do not want to block until the actor is fully initialized in <code>actorOf</code>,
and b) we are bound to perform some async work during initialization since the <code>/user</code> guardian is an actor,
so the way to communicate with it is via async operations.</p>
</div>
<div class="paragraph">
<p>Initial steps of starting a top level actor are "reserving" the name in the user guardians <code>ChildrenContainer</code>.
This is a special datastructure in which we keep all the child actors. The first thing to do <strong>synchronously (!)</strong>
is to reserve the new name, in order to be able to predictably be able to handle attempts of starting actors with
the same name from different threads, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>// Thread 1:
  system.actorOf(..., name = "major")

// Thread 2, concurrently:
  system.actorOf(..., name = "major")

// one of those calls is guaranteed to throw</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>guarantee</strong> given by the actor system is that always exactly one of the calls will succeed and the other will fail with an <code>InvalidActorNameException(s"actor name [$name] is not unique!")</code>. This is why spawning</p>
</div>
<div class="paragraph">
<p>Actors are identified not only by path but also UUID.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>val childPath = new ChildActorPath(cell.self.path, name, ActorCell.newUid())
cell.provider.actorOf(cell.systemImpl, props, cell.self, childPath,
            systemService = systemService, deploy = None, lookupDeploy = true, async = async)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This brings us to another abstraction inside the core of Akka: <code>ActorRefProvider</code>.
Currently two implementations of it exist: the <code>LocalActorRefProvider</code> and the <code>RemoteActorRefProvider</code>.
The remote one is only needed for deploying actors on remote nodes, which is a terrible hack and an idea the team would like to get rid of. TODO CHECK THIS.</p>
</div>
<div class="paragraph">
<p>We will focus only on the <code>LocalActorRefProvider</code> in this section. Not only does it actually create the ActorRef that we&#8217;ll be able to hand out,
it also does look at configuration of the system, since depending on the actor&#8217;s path there may be configuration which makes it use some specific
dispatcher. This works in tandem with settings passed in using <code>Props</code>. One can configure actor props using the <code>Props</code> object or by configuring it
in <code>application.conf</code> in the deployment section of it.</p>
</div>
<div class="paragraph">
<p>Finally, the <code>LocalActorRefProvider</code> applies all config and creates our ref:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>if (async) new RepointableActorRef(system, props2, dispatcher, mailboxType, supervisor, path).initialize(async)
else new LocalActorRef(system, props2, dispatcher, mailboxType, supervisor, path)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that when using the async init mode (we are using this mode for top-level actors, so we will focus on that), we create a special
<code>RepointableActorRef</code>. This is another reason why top-level refs are more "expensive", they initialize asynchronously and while that init is in flight, they don&#8217;t actually have a mailbox ready yet (!). This means the ref itself is buffering messages until the mailbox is initialized and the
repointable ref is "pointed at" the ready and live cell with its mailbox.</p>
</div>
<div class="paragraph">
<p>To understand this a bit more, let&#8217;s look at the <code>def !(msg)(sender): Unit</code> implementation of the <code>RepointableActorRef</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>underlying.sendMessage() // TODO</code></pre>
</div>
</div>
<div class="paragraph">
<p>Internally this ends up executing in the so-called <code>UnstartedCell</code>. The <code>ActorCell</code> in general is the "heart" of the Actor,
yet here it is not yet started&#8230;&#8203; so it has to keep acting as if it works before it is started and ready for scheduling&#8230;&#8203;
It also has no mailbox ready yet, which means it has to internally implement one as "best effort" which will be used for <em>the few milliseconds
until the mailbox initialization completes and the cell is started</em>. This brings us to one of the very few locks in the entirety of Akka,
in the implementation of <code>sendMessage</code> of the <code>UnstartedCell</code> we see:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>private[akka] class UnstartedCell(
  val systemImpl: ActorSystemImpl,
  val self:       RepointableActorRef,
  val props:      Props,
  val supervisor: InternalActorRef) extends Cell {

  /*
   * This lock protects all accesses to this cell’s queues. It also ensures
   * safe switching to the started ActorCell.
   */
  private[this] final val lock = new ReentrantLock

  // use Envelope to keep on-send checks in the same place ACCESS MUST BE PROTECTED BY THE LOCK
  private[this] final val queue = new JLinkedList[Envelope]()

  // ACCESS MUST BE PROTECTED BY THE LOCK
  private[this] var sysmsgQueue: LatestFirstSystemMessageList = SystemMessageList.LNil</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>  def sendMessage(msg: Envelope): Unit = {
    if (lock.tryLock(timeout.length, timeout.unit)) {
      try {
        val cell = self.underlying
        if (cellIsReady(cell)) {
          cell.sendMessage(msg)
        } else if (!queue.offer(msg)) {
          system.eventStream.publish(Warning(self.path.toString, getClass, "dropping message of type " + msg.message.getClass + " due to enqueue failure"))
          system.deadLetters.tell(DeadLetter(msg.message, msg.sender, self), msg.sender)
        } else if (Mailbox.debug) println(s"$self temp queueing ${msg.message} from ${msg.sender}")
      } finally lock.unlock()
    } else {
      system.eventStream.publish(Warning(self.path.toString, getClass, "dropping message of type" + msg.message.getClass + " due to lock timeout"))
      system.deadLetters.tell(DeadLetter(msg.message, msg.sender, self), msg.sender)
    }
  }</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_context_actorof">context.actorOf</h5>
<div class="paragraph">
<p>This method allows spawning child actors when you "are" an actor. This spawns them "under" yourself and also makes you their supervisor.
In other words, in Akka (Untyped) the one who makes child actors, is automatically responsible (supervising) for them. This is unlike Erlang,
where supervision is completely separate. Later on we&#8217;ll discuss <code>watch</code> as well, but that is different than supervision.</p>
</div>
<div class="paragraph">
<p>Note also that since we are now attaching new children to our own <code>ChildrenContainer</code> which is held by the actor we&#8217;re in,
it means that we need to additional synchronization during startup of the new actor (!).</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_differences_between_system_actors_and_normal_ones">3.4. Differences between System Actors and normal ones</h3>
<div class="paragraph">
<p>System actors ignore the deployment section; they may only be local.</p>
</div>
<div class="paragraph">
<p>Remote deployment is a messa anyway&#8230;&#8203;</p>
</div>
</div>
<div class="sect2">
<h3 id="_do_the_guardian_actors_have_a_parent">3.5. Do the Guardian actors have a parent?</h3>
<div class="paragraph">
<p>An interesting question is&#8230;&#8203; "Do the Guardian actors have a parent?"</p>
</div>
<div class="paragraph">
<p>After all, they are actors as well, and as we know, in Akka "every actor has a parent".</p>
</div>
<div class="paragraph">
<p>Indeed, the guardians do have a parent Actor. It is <code>theOneWhoWalksTheBubblesOfSpaceTime</code> <sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>The unstarted cell waits for the parent to get the <code>Supervise</code> message and only then the real cell with user code is started.
This is because the parent needs to know about the child in order to be able to apply the supervision things.</p>
</div>
</div>
<div class="sect2">
<h3 id="_restarting_actors">3.6. Restarting Actors</h3>
<div class="paragraph">
<p>This is why we can do <code>newCell</code>&#8201;&#8212;&#8201;we restart it "in place" while the mailbox remains untouched.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sending_local_messages">3.7. Sending (Local) Messages</h3>
<div class="sect3">
<h4 id="_sending_user_messages">3.7.1. Sending user messages</h4>
<div class="paragraph">
<p>All messages which are send by users in an Akka application between actors are referred to as "user messages".</p>
</div>
<div class="paragraph">
<p>The delivery guarantee provided for such messages is <em>at-most-once</em>, which holds true for either the remote
or local case. After all, evne in a local setting the JVM may crash at any time (well, in theory at least!),
thus the "at most once" part holding true even in local applications. In practice though one often assumes
that messages will be delivered unless we are thinking about critical for correctness things, where we can
apply at-least-once delivery to messages, which is slower and most costly however can achieve this by also
applying persistence before.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">note</dt>
<dd>
<p>Akka provides <em>at-most-once delivery</em> guarantees for <em>plain actor messaging</em>, and on top of this is able
to implement <em>at-least-once delivery</em> when it is required. One might be suprised how often at-most once is most of the time enough for most applications.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_sending_system_messages">3.7.2. Sending system messages</h4>
<div class="paragraph">
<p>System messages are a special, they are (best effort) guaranteed to be delivered. This is because many invariants
of your system depend on those messages. This means that they are internally buffered and re-delivered in thr distributed setting, and in the local setting it means that even if you pick a mailbox that is bounded, system messages actually use a separate queue (which we&#8217;ll investigate in a second) as they must not bbe dropped on the floor to keep correctness of core akka things, such as death watch, lifecycle events and supervision.</p>
</div>
<div class="paragraph">
<p>As a short reminder, system messages are for example <code>Terminated(ref)</code> which you may have seen (as it is sent
as effect of a watched actor terminating), or deeply internal messages like <code>Supervise</code> which is sent from
asynchronously spawned child actor to it&#8217;s parent so the parent can become its supervisor (this is during child
actor starting).</p>
</div>
<div class="paragraph">
<p>Unlike user messages which are any kind of message that users send within an Akka application
system messages. Let&#8217;s first see what the <code>SystemMessage</code> trait is implemented as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>/**
 * INTERNAL API
 * ...
 * &lt;b&gt;NEVER SEND THE SAME SYSTEM MESSAGE OBJECT TO TWO ACTORS&lt;/b&gt;
 */
private[akka] sealed trait SystemMessage extends PossiblyHarmful with Serializable {
  // Next fields are only modifiable via the SystemMessageList value class
  @transient
  private[sysmsg] var next: SystemMessage = _

  // ... queue operations ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may be surprised to see the "never send the same system message" information here. This is because
system messages ARE the message queue (!). This is to save space in the Actor Mailbox so we don&#8217;t have
two complicated queues but only one, and the simplified one for system messages which is simply
a single linked list of the messages.</p>
</div>
<div class="paragraph">
<p>This allows us to implement the system message queue in the actor mailbox as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code> * INTERNAL API
 */
private[akka] abstract class Mailbox(val messageQueue: MessageQueue)
  extends ForkJoinTask[Unit] with SystemMessageQueue with Runnable {

  // ...

  @volatile
  protected var _statusDoNotCallMeDirectly: Status = _ //0 by default

  @volatile
  protected var _systemQueueDoNotCallMeDirectly: SystemMessage = _ //null by default</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sending_messages_to_distant_nodes_remoting">3.8. Sending Messages to distant nodes (Remoting)</h3>
<div class="sect3">
<h4 id="_sending_user_messages_2">3.8.1. Sending user messages</h4>

</div>
<div class="sect3">
<h4 id="_sending_system_messages_2">3.8.2. Sending system messages</h4>

</div>
</div>
<div class="sect2">
<h3 id="_processing_messages">3.9. Processing messages</h3>
<div class="paragraph">
<p>First system messages are processed&#8201;&#8212;&#8201;all of them.</p>
</div>
<div class="paragraph">
<p>Next user messages are processed, until the <code>throughput</code> limit. We also experimented with a time limit,
but in reality this was never used&#8201;&#8212;&#8201;calculating time costs after all.</p>
</div>
</div>
<div class="sect2">
<h3 id="_death_watch_watch_ing_actors_for_lifecycle_events">3.10. Death Watch: <code>watch</code>-ing Actors for lifecycle events</h3>
<div class="paragraph">
<p>Death watch is modeled after Erlang&#8217;s <code>monitor</code> <sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup> API, in which processes bind their lifecycles to one another.</p>
</div>
<div class="paragraph">
<p>Lifecycle monitoring of other Actors is quite an important part of Actor systems, since thanks to this one can easily tear down
entire groups of actors that "only work if others work as well". The concept itself is also present in Erlang, where it is called
<code>monitor/2</code></p>
</div>
<div class="sect3">
<h4 id="_dying_together_with_deathpactexception">3.10.1. Dying together, with <code>DeathPactException</code></h4>
<div class="paragraph">
<p>When you <code>context.watch(ref)</code> an actor and <em>do not</em> handle the resulting <code>Terminated(ref)</code>
messages, this results in an <code>DeathPactException</code> being thrown by the watching actor.</p>
</div>
<div class="paragraph">
<p>In other words, if you only watch, and don&#8217;t implement logic that handles termination,
the default behavior is for the watcher to kill itself if the watched actor terminates.
This is referred to as the "death pact".</p>
</div>
<div class="paragraph">
<p>A good way to visualize death pact&#8217;s default behavior is Shakespeare&#8217;s play Romeo and Juliet,
in which during the plays finale Romeo finds Juliet "dead", so he decides to kill himself as he can not
imagine continuing life without her. Shortly after, once Juliet wakes up and sees Romeo really dead,
she decides to kill herself <em>for real</em> this time. In the end, both actors are dead.</p>
</div>
<div class="paragraph">
<p>Note that, unlike in Shakespeare&#8217;s play, the <code>Terminated()</code> message will never fire prematurely.
Once it has been sent we know for certain that the terminated actor is indeed dead.
This is somewhat more interesting in clusterd environment, where <code>Terminated</code> can fire when an entire node
is marked as <code>Down</code>&#8201;&#8212;&#8201;since the actor itself may not have actually terminated&#8230;&#8203; however, since the entire node
is declared as <code>Down</code>, we <em>know</em> that we will never receive a message from it ever again.</p>
</div>
<div class="paragraph">
<p>In clustering, this effect has the simple mnemonic of: "We do not talk to zombies."</p>
</div>
<div class="paragraph">
<p>One more note about the Romeo &amp; Juliet example: You may have noticed that the terminating oneself is somewhat "mutual"
in the play. Once Romeo notices Juliet dead, he kills himself, and likewise once Juliet notices Romeo dead, she kills herself.
In Akka terms, this could be seen as two actors, which watch <em>eachother</em>, which means that whichever actor terminates first,
the other one will terminate itself in response to this lifecycle event.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_remoting_internals">4. Remoting internals</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_streaming_remoting_pipeline">4.1. Streaming remoting pipeline</h3>
<div class="sect3">
<h4 id="_parallelizing_multiple_lanes">4.1.1. Parallelizing multiple "lanes"</h4>

</div>
</div>
<div class="sect2">
<h3 id="_message_metadata_compression_table_protocol">4.2. Message Metadata Compression Table Protocol</h3>

</div>
<div class="sect2">
<h3 id="_swappable_transports_aeron_udp_akka_io_tcptls">4.3. Swappable transports Aeron (UDP) / Akka IO (TCP+TLS)</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_apis_that_guide_and_protect">5. APIs that guide and protect</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_streams_graphstagedesign_analysis">5.1. Streams' GraphStage&#8201;&#8212;&#8201;design analysis</h3>

</div>
<div class="sect2">
<h3 id="_typed_actorsdesign_analysis">5.2. Typed Actors&#8201;&#8212;&#8201;design analysis</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_stream_api_levels_of_power_and_abstraction">6. Stream API levels of power and abstraction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_operators_the_safe_heaven">6.1. Operators, the "safe heaven"</h3>

</div>
<div class="sect2">
<h3 id="_graphs_for_arbitrary_shapes">6.2. Graphs, for arbitrary shapes</h3>

</div>
<div class="sect2">
<h3 id="_stages_for_arbitrary_logic_protected_from_concurrency_issues">6.3. Stages, for arbitrary logic protected from concurrency issues</h3>

</div>
<div class="sect2">
<h3 id="_reactive_streams_spi_all_concurrency_issues_and_hell_set_lose">6.4. Reactive Streams SPI, all concurrency issues and hell set lose</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_depths_of_stream_materialization">7. The depths of Stream Materialization</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_materialization_or_traversing_the_blueprints">7.1. Materialization, or "Traversing the blueprints"</h3>
<div class="paragraph">
<p><a href="https://github.com/akka/akka/blob/master/akka-stream/src/main/scala/akka/stream/impl/package.scala" class="bare">https://github.com/akka/akka/blob/master/akka-stream/src/main/scala/akka/stream/impl/package.scala</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_examining_the_engine_running_it_all_actorinterpreter">7.2. Examining the Engine running it all: ActorInterpreter</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_scheduling_timers">8. Scheduling (Timers)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_no_wall_clock_time_in_a_cluster">8.1. No wall-clock time in a Cluster</h3>

</div>
<div class="sect2">
<h3 id="_the_lightarrayrevolverscheduler">8.2. The LightArrayRevolverScheduler</h3>

</div>
<div class="sect2">
<h3 id="_the_un_deniable_existence_of_wall_clock_time">8.3. The un-deniable existence of wall-clock time</h3>
<div class="sect3">
<h4 id="_timers_and_the_scheduler">8.3.1. Timers and the Scheduler</h4>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cluster_failure_detection">9. Cluster Failure-detection</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_transport_failures_and_cluster_level_semantics">9.1. Transport failures and Cluster-level semantics</h3>
<div class="paragraph">
<p>Quarantines&#8201;&#8212;&#8201;transport</p>
</div>
<div class="paragraph">
<p>Cluster-level unreachability</p>
</div>
</div>
<div class="sect2">
<h3 id="_fail_over_scenarios_exposed">9.2. Fail-over scenarios exposed</h3>
<div class="paragraph">
<p><a href="https://support.lightbend.com/agent/case/10623" class="bare">https://support.lightbend.com/agent/case/10623</a> and others by him</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_networks_and_types">10. Networks and Types</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_a_receptionist_for_thy_actors">10.1. A Receptionist for thy Actors</h3>
<div class="paragraph">
<p>Imagine you&#8217;re on a work trip in some foreign country, you&#8217;re jet lagged, batteries in all your electronic devices
have drained, and yet you somehow manage to arrive at the hotel you booked. You want to meet your friend who&#8217;s (maybe),
already checked-in at the same hotel (though you&#8217;re not quite sure, your flights were arriving concurrently after all,
and traffic was terrible on the way to the hotel!) You do want to meet your friend, however you&#8217;re not sure how to find them,
you don&#8217;t know the room number (the "Address") after all.</p>
</div>
<div class="paragraph">
<p>You wouldn&#8217;t (I hope, at least) barge into random people&#8217;s hotel rooms, trying to find your friend&#8217;s room,
by vaguely remembering something they told you before ("<em>&#8230;&#8203; was it that they only stay in rooms that end with a 7?</em>").
You&#8217;d ask at the <em>reception</em>, if your friend has arrived, and if they could either call them down for you or tell you their room number.</p>
</div>
<hr>
<div class="paragraph">
<p>Similarily, one should not rely on randomly guessing an <code>Actor</code> 's address! This, in fact, describes the difference between using <code>.actorSelection(String)</code> and a proper <code>Receptionist</code> to locate an <code>Actor</code>. Far too often, perhaps tempted by scars of the past of
using service locators which return instances if only you knew the right identifier, I&#8217;ve seen developers resolve to exclusively using
selection to locate "well known actors". This however is increadibly brittle, as the <strong>path</strong> of an Actor really should be it&#8217;s own thing,
you should not try to remember and reconstruct by concating strings and guessing where the Actor may live&#8201;&#8212;&#8201;similarily how looking for our
friends hotel room by guessing, is probably a bad idea, you may, after all, end up in someone else&#8217;s room, and cause everyone quite a hassle.</p>
</div>
<div class="paragraph">
<p>In Actor systems this is about not integrating over the paths, which could be dynamically allocated, or even changing since there is a rollout
ongoing, and in the new version of the software that specific actor has moved somewhere.</p>
</div>
<div class="paragraph">
<p>By using an Receptionist, we share a piece of information, the <code>ServiceKey[M]</code>, by which we can ask the receptionist if the Actor has already,
checked-in or not yet. Notice that this also deals nicer with typing, as here the Actor, while checking in, lets the receptionist know which protocol
(messages of type <code>M</code>) it is able to speak. This way, even if there&#8217;s two actors called "bob", but only one of them speaks the protocol you want to
communicate with, you&#8217;d be able to get the right <code>ActorRef[M]</code> from the Receptionist.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_type_safe_http">11. Type-safe HTTP</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_akka_https_domain_model">11.1. Akka HTTP&#8217;s Domain Model</h3>
<div class="paragraph">
<p>A fully type-safe representation of the HTTP domain is difficult to pull off.
HTTP is notorious for its corner cases and ambiguities.</p>
</div>
<div class="paragraph">
<p>JSON example</p>
</div>
</div>
<div class="sect2">
<h3 id="_spraying_the_routesa_note_on_type_safe_routing_dsls">11.2. Spraying the Routes&#8201;&#8212;&#8201;a note on type-safe routing DSLs</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_people_crazy_enough_to_think_they_can_change_the_world">12. The people crazy enough to think they can change the world&#8230;&#8203;</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section we will explore random crazy ideas that may change how actor systems look like in
"magical dream land" implementations.</p>
</div>
<div class="paragraph">
<p><a href="https://www.goodreads.com/author/show/14907567.Rob_Siltanen" class="bare">https://www.goodreads.com/author/show/14907567.Rob_Siltanen</a></p>
</div>
<div class="sect2">
<h3 id="_asyncawait_within_receive_blocks">12.1. Async/await within receive blocks</h3>

</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Akka&#8217;s 5th anniversary infographic <a href="https://www.lightbend.com/akka-five-year-anniversary" class="bare">https://www.lightbend.com/akka-five-year-anniversary</a>
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. Yes, there exist commercial addons, after all Lightbend is a company targeting enterprises, and those have specific "enterprisy" needs that those addons address. They are just that however&#8201;&#8212;&#8201;addons&#8201;&#8212;&#8201;and none of them really "core" things are developed closed.
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. theOneWhoWalksTheBubblesOfSpaceTime - <a href="https://github.com/akka/akka/blob/e6633f17fac9b2fe1100af73b18add3ac24ad0df/akka-actor/src/main/scala/akka/actor/ActorRefProvider.scala#L519-L554" class="bare">https://github.com/akka/akka/blob/e6633f17fac9b2fe1100af73b18add3ac24ad0df/akka-actor/src/main/scala/akka/actor/ActorRefProvider.scala#L519-L554</a>
</div>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. Erlang&#8217;s monitor function: <a href="http://erlang.org/doc/reference_manual/processes.html#monitors" class="bare">http://erlang.org/doc/reference_manual/processes.html#monitors</a>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-07-16 14:37:11 JST
</div>
</div>
</body>
</html>